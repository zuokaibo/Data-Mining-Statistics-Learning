---
title: "HW2"
author: "Bo"
date: "2026-02-06"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r cars}
fat = read.csv("fat.csv")
head(fat)
```
```{r}
str(fat)
```


```{r pressure, echo=FALSE}
summary(fat)
```


```{r}
library(psych)
```

```{r}
psych::pairs.panels(fat)
```

```{r}
#(a)
n = dim(fat)[1]
n1 = round(n/10)
flag = c(1,21,22,57,70,88,91,94,121,127,149,151,159,162,164,177,179,194,206,214,215,221,240,241,243)
fattrain=fat[-flag, ]
fattest = fat[flag, ]
dim(fattrain)
dim(fattest)
```

```{r}
#(b)
summary(fattrain)
```


```{r}
boxplot(fattrain, main="Box plots for all variables")
```

```{r}
# since the unit of each column is different, they need a normalization.
standardize = function(x){
  z = (x-min(x))/(max(x) - min(x))
  return (z)
}
```

```{r}
fat1train = as.data.frame(apply(fattrain, 2, standardize))
head(fat1train)
```

```{r}
fat1test = as.data.frame(apply(fattest, 2, standardize))
dim(fat1test)
```

```{r}
boxplot(fat1train, main="Box plot of each normalized variables")
```

```{r}
#(c)
#(i) Linear regression model with all predictors
linear =  lm(brozek~., data=fat1train)
summary(linear)

```

```{r}
#(ii)
LinearFive = lm(brozek~siri+density+weight+free+thigh, data=fat1train)
summary(LinearFive)
```

```{r}
#(iii)
aiclinear = lm(brozek~., data=fat1train)
AIClinear=step(aiclinear, direction="both")
summary(AIClinear)

```

```{r}
#(iv)
library(glmnet)
```
```{r}
# model.matrix() requires x and y input, not a built model. brozek~.means brozek is dependent variable, all else are independent variables.
x = model.matrix(brozek~.,  data=fat1train)
y=fat1train$brozek
```

```{r}
# set alpha = 0 is ridge, 1 is lasso
linear.ridge = glmnet(x, y, alpha = 0)
plot(linear.ridge, xvar="norm", label=TRUE)

cv.ridge = cv.glmnet(x, y, alpha=0)
plot(cv.ridge)
cv.ridge$lambda.min
cv.ridge$lambda.1se

coef(cv.ridge, s=cv.ridge$lambda.1se)
```


```{r}
#(v)lasso
fit.lasso = glmnet(x, y, alpha=1)
plot(fit.lasso, xvar="lambda", label=TRUE)

cv.lasso = cv.glmnet(x,y)
plot(cv.lasso)
cv.lasso$lambda.min
cv.lasso$lambda.1se

coef(cv.lasso, s=cv.lasso$lambda.1se)
```



```{r}
library(pls)
```

```{r}
#(vi)PCR
pcr.model=pcr(brozek~., data=fat1train, validation="CV")
summary(pcr.model)
validationplot(pcr.model, val.type = "MSEP")
validationplot(pcr.model, val.type = "R2")
```

```{r}
#(vii)PLS
pls.model=plsr(brozek~.,data=fat1train, validation="CV")
summary(pls.model)
validationplot(pls.model, val.type="MSEP")
validationplot(pls.model, val.type="R2")
```

```{r}
#(d)
linearprediction = as.data.frame(predict(linear, newdata=fat1test))
#linearprediction
dim(linearprediction)
dim(fat1test)
te.linear = mean(sum((fat1test$brozek - linearprediction)^2))
te.linear
```

```{r}
linearfiveprediction = as.data.frame(predict(LinearFive, newdata=fat1test))
te.linearfive = mean(sum((fat1test$brozek - linearfiveprediction)^2))
te.linearfive
```

```{r}
aic.prediction = as.data.frame(predict(AIClinear, newdata=fat1test))
dim(aic.prediction)
te.aic = mean(sum((fat1test$brozek - aic.prediction)^2))
te.aic
```

```{r}
x.test = model.matrix(brozek~.,  data=fat1test)
y.test = fat1test$brozek
min(linear.ridge$lambda)
```

```{r}
ridge.prediction = as.data.frame(predict(linear.ridge, s=cv.ridge$lambda.1se, newx=x.test))
dim(ridge.prediction)
te.ridge = mean(sum((fat1test$brozek - ridge.prediction)^2))
te.ridge
```

```{r}
lasso.prediction = as.data.frame(predict(fit.lasso, s=cv.lasso$lambda.1se, newx=x.test))
dim(lasso.prediction)
te.lasso=mean(sum((fat1test$brozek - lasso.prediction)^2))
te.lasso
```

```{r}
pcr.predict = as.data.frame(predict(pcr.model, fat1test, ncomp=3))
dim(pcr.predict)
te.pcr=mean(sum((fat1test$brozek - pcr.predict)^2))
te.pcr
```

```{r}
pls.predict=as.data.frame(predict(pls.model, fat1test, ncomp=3))
dim(pls.predict)
te.pls = mean(sum((fat1test$brozek - pls.predict)^2))
te.pls
```



























































































